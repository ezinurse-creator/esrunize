<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta id="viewport-meta" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ezi Nurse | Professional Nursing Education</title>
<style>
    :root {
        --primary: #0EA5E9;
        --primary-dark: #0C4A6E;
        --primary-light: #E0F2FE;
        --bg-card: #FFFFFF;
        --secondary: #334155;
        --accent: #F59E0B;
        --bg-body: #F8FAFC;
        --text-main: #0F172A;
        --text-muted: #64748B;
        --danger: #EF4444;
        --success: #10B981;
        --border: #E2E8F0;
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    * { 
        margin: 0; 
        padding: 0; 
        box-sizing: border-box; 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
    
    html, body { 
        height: 100%; 
        width: 100%; 
        overflow: hidden; 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: var(--text-main); 
    }
    
    body.zoom-mode { 
        overflow: auto !important; 
        touch-action: manipulation !important; 
    }
    
    #app {
        width: 100%; 
        max-width: 480px; 
        margin: 0 auto;
        background: var(--bg-body); 
        height: 100%; 
        position: relative;
        display: flex; 
        flex-direction: column;
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
        overflow: hidden;
    }
    
    /* Watermark - more subtle */
    .watermark-strip {
        position: absolute; 
        top: 50%; 
        left: 50%; 
        width: 200%;
        transform: translate(-50%, -50%) rotate(-45deg);
        z-index: 9999; 
        pointer-events: none;
        display: flex; 
        align-items: center; 
        justify-content: center;
        font-size: 11px; 
        font-weight: 700;
        color: rgba(15, 23, 42, 0.04);
        user-select: none; 
        white-space: nowrap; 
        letter-spacing: 4px;
        text-transform: uppercase;
    }
    
    /* Modern floating zoom button */
    #fab-zoom {
        position: absolute; 
        bottom: 24px; 
        right: 24px; 
        width: 56px; 
        height: 56px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        border-radius: 50%;
        box-shadow: var(--shadow-xl);
        display: none;
        align-items: center; 
        justify-content: center;
        font-size: 24px; 
        color: white; 
        cursor: pointer; 
        z-index: 100;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    #fab-zoom:hover {
        transform: scale(1.1);
        box-shadow: 0 25px 30px -5px rgba(0, 0, 0, 0.2);
    }
    
    #fab-zoom:active { 
        transform: scale(0.95); 
    }
    
    .view { 
        flex: 1; 
        padding: 24px; 
        overflow-y: auto; 
        display: none; 
        animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
        padding-bottom: 80px; 
    }
    
    .view.active { 
        display: flex; 
        flex-direction: column; 
    }
    
    #view-iframe.view { 
        padding: 0 !important; 
        height: 100%; 
        width: 100%; 
        z-index: 50; 
        -webkit-overflow-scrolling: touch; 
        overflow: auto; 
        position: relative; 
    }
    
    .iframe-wrapper { 
        width: 100%; 
        height: 100%; 
        transform-origin: 0 0; 
        transition: transform 0.3s ease, width 0.3s ease; 
    }
    
    iframe { 
        width: 100%; 
        height: 100%; 
        border: none; 
        display: block; 
        background: #fff; 
    }
    
    /* Modern header with gradient */
    .header {
        padding: 20px 24px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        display: flex; 
        align-items: center; 
        justify-content: space-between;
        z-index: 10; 
        flex-shrink: 0;
        box-shadow: var(--shadow-md);
    }
    
    .header-title { 
        font-weight: 800; 
        font-size: 1.5rem; 
        color: white;
        letter-spacing: -0.5px;
    }
    
    .header-title span { 
        color: var(--accent);
        font-weight: 900;
    }
    
    .back-btn { 
        background: rgba(255, 255, 255, 0.2); 
        border: none; 
        font-size: 1.3rem; 
        color: white;
        cursor: pointer; 
        display: none;
        width: 40px;
        height: 40px;
        border-radius: var(--radius-md);
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
        transition: all 0.2s;
    }
    
    .back-btn:hover {
        background: rgba(255, 255, 255, 0.3);
    }
    
    .logout-btn { 
        font-size: 0.875rem; 
        color: white;
        font-weight: 600; 
        cursor: pointer;
        background: rgba(255, 255, 255, 0.2);
        padding: 8px 16px;
        border-radius: var(--radius-md);
        backdrop-filter: blur(10px);
        transition: all 0.2s;
    }
    
    .logout-btn:hover {
        background: rgba(255, 255, 255, 0.3);
    }
    
    @keyframes fadeIn { 
        from { opacity: 0; transform: translateY(10px); } 
        to { opacity: 1; transform: translateY(0); } 
    }
    
    .auth-container { 
        flex: 1; 
        display: flex; 
        flex-direction: column; 
        justify-content: center; 
        padding-bottom: 5vh; 
        max-width: 400px;
        margin: 0 auto;
        width: 100%;
    }
    
    .btn {
        width: 100%; 
        padding: 16px; 
        border-radius: var(--radius-md); 
        border: none;
        font-size: 1rem; 
        font-weight: 600; 
        cursor: pointer; 
        margin-bottom: 12px;
        display: flex; 
        align-items: center; 
        justify-content: center;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: var(--shadow-sm);
    }
    
    .btn-primary { 
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: white;
        box-shadow: var(--shadow-md);
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }
    
    .btn-primary:active {
        transform: translateY(0);
    }
    
    .btn-outline { 
        background: transparent; 
        border: 2px solid var(--primary); 
        color: var(--primary);
    }
    
    .btn-outline:hover {
        background: var(--primary-light);
    }
    
    .btn-ghost { 
        background: transparent; 
        color: var(--text-muted); 
        font-size: 0.9rem;
        box-shadow: none;
    }
    
    .btn-ghost:hover {
        color: var(--primary);
    }
    
    /* Enhanced menu items with better hierarchy */
    .menu-item {
        background: white;
        border: 1px solid var(--border);
        padding: 20px;
        border-radius: var(--radius-lg);
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        margin-bottom: 12px;
        box-shadow: var(--shadow-sm);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .menu-item:hover {
        transform: translateX(4px);
        box-shadow: var(--shadow-md);
        border-color: var(--primary);
    }
    
    .menu-item h3 { 
        font-size: 1.1rem; 
        color: var(--text-main);
        margin-bottom: 4px;
        font-weight: 700;
    }
    
    .menu-item p { 
        font-size: 0.85rem; 
        color: var(--text-muted);
        font-weight: 500;
    }
    
    .menu-arrow { 
        color: var(--primary);
        font-size: 1.2rem;
        transition: transform 0.2s;
    }
    
    .menu-item:hover .menu-arrow {
        transform: translateX(4px);
    }
    
    /* Special highlight for premium items */
    .menu-item.premium {
        background: linear-gradient(135deg, rgba(14, 165, 233, 0.05) 0%, rgba(12, 74, 110, 0.05) 100%);
        border-color: var(--primary);
    }
    
    .menu-item.premium h3 {
        color: var(--primary);
    }
    
    /* Modern form styling */
    .form-group { 
        margin-bottom: 20px; 
    }
    
    .form-label { 
        display: block; 
        margin-bottom: 8px; 
        font-size: 0.875rem; 
        font-weight: 600; 
        color: var(--text-main);
        letter-spacing: 0.3px;
    }
    
    .form-input { 
        width: 100%; 
        padding: 14px 16px;
        border: 2px solid var(--border);
        border-radius: var(--radius-md);
        font-size: 1rem;
        outline: none;
        background: white;
        transition: all 0.2s;
        color: var(--text-main);
    }
    
    .form-input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-light);
    }
    
    .password-wrapper { 
        position: relative; 
        display: flex; 
        align-items: center; 
    }
    
    .form-input-pass { 
        padding-right: 45px; 
    }
    
    .toggle-password-btn { 
        position: absolute; 
        right: 12px; 
        background: none; 
        border: none; 
        cursor: pointer; 
        color: var(--text-muted);
        font-size: 1.2rem;
        padding: 8px;
        border-radius: var(--radius-sm);
        transition: all 0.2s;
    }
    
    .toggle-password-btn:hover {
        background: var(--bg-body);
        color: var(--primary);
    }
    
    .error-msg { 
        color: var(--danger); 
        font-size: 0.85rem; 
        margin-top: 8px; 
        min-height: 20px; 
        text-align: center;
        font-weight: 500;
    }
    
    /* Improved paywall design */
    .paywall-container { 
        flex: 1; 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        justify-content: center; 
        text-align: center; 
        padding: 24px;
        max-width: 400px;
        margin: 0 auto;
    }
    
    .headline { 
        font-size: 1.75rem;
        font-weight: 800;
        color: var(--text-main);
        margin-bottom: 12px;
        letter-spacing: -0.5px;
        line-height: 1.2;
    }
    
    .subtext { 
        color: var(--text-muted);
        line-height: 1.6;
        margin-bottom: 30px;
        font-size: 1rem;
    }
    
    .logo-text-large { 
        font-size: 3rem;
        font-weight: 900;
        color: var(--primary-dark);
        margin-bottom: 10px;
        letter-spacing: -1px;
    }
    
    .logo-text-large span { 
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    /* Enhanced pricing display */
    .price-wrapper { 
        margin-bottom: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        background: linear-gradient(135deg, rgba(14, 165, 233, 0.1) 0%, rgba(12, 74, 110, 0.1) 100%);
        padding: 24px 32px;
        border-radius: var(--radius-lg);
        border: 2px solid var(--primary-light);
    }
    
    .price-original { 
        text-decoration: line-through;
        color: var(--text-muted);
        font-size: 1.1rem;
        font-weight: 500;
    }
    
    .price-discounted { 
        color: var(--primary-dark);
        font-weight: 900;
        font-size: 2.5rem;
        line-height: 1;
    }
    
    .price-label { 
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        color: var(--primary);
        font-weight: 700;
        background: var(--primary-light);
        padding: 4px 12px;
        border-radius: 20px;
    }
    
    /* Modern modal */
    .modal-overlay { 
        position: absolute; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(0, 0, 0, 0.6);
        display: flex; 
        align-items: center; 
        justify-content: center; 
        z-index: 100; 
        backdrop-filter: blur(8px);
        animation: fadeIn 0.2s ease;
    }
    
    .modal-card { 
        background: white;
        width: 90%;
        max-width: 350px;
        padding: 28px;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-xl);
        text-align: center;
        animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .hidden { 
        display: none !important; 
    }
    
    /* Additional polish */
    .right-align {
        text-align: right;
        margin-bottom: 15px;
    }
    
    .right-align span {
        color: var(--primary);
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .right-align span:hover {
        color: var(--primary-dark);
        text-decoration: underline;
    }
    
    /* Scrollbar styling */
    .view::-webkit-scrollbar {
        width: 6px;
    }
    
    .view::-webkit-scrollbar-track {
        background: var(--bg-body);
    }
    
    .view::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 10px;
    }
    
    .view::-webkit-scrollbar-thumb:hover {
        background: var(--text-muted);
    }
</style>
</head>
<body>
<div id="app">
    <div id="wm-diagonal" class="watermark-strip"></div>
    <header class="header">
        <button class="back-btn" id="btn-back" onclick="app.goBack()">‚Üê</button>
        <div class="header-title" id="header-branding">Ezi<span>Nurse</span></div>
        <div onclick="app.logout()" class="logout-btn" id="btn-logout">Logout</div>
    </header>
    <div id="fab-zoom" onclick="app.toggleZoom()">üîç</div>

    <div id="view-auth" class="view active">
        <div class="auth-container">
            <div style="text-align: center; margin-bottom: 32px;">
                <div class="logo-text-large">Ezi<span>Nurse</span></div>
                <h1 class="headline" style="font-size: 1.5rem;">Welcome Back</h1>
                <p class="subtext">Sign in to access your dashboard</p>
            </div>
            
            <div id="form-login">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="login-email" class="form-input" placeholder="nurse@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="login-pass" class="form-input form-input-pass">
                        <button class="toggle-password-btn" onclick="app.togglePassword('login-pass', this)">üëÅ</button>
                    </div>
                </div>
                <div class="right-align">
                    <span onclick="app.navTo('view-reset')">Forgot Password?</span>
                </div>
                <div id="login-error" class="error-msg"></div>
                
                <button id="btn-login-submit" class="btn btn-primary" onclick="app.login()">Login Securely</button>
                <button class="btn btn-primary" style="background: linear-gradient(135deg, var(--primary-dark) 0%, #1e3a8a 100%); margin-top: 8px;" onclick="app.toggleAuthMode()">Create New Account</button>
            </div>

            <div id="form-signup" class="hidden">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="signup-name" class="form-input" placeholder="Nurse Joy">
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="signup-email" class="form-input" placeholder="new@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" id="signup-phone" class="form-input" placeholder="9876543210">
                </div>
                <div class="form-group">
                    <label class="form-label">How did you hear about us?</label>
                    <input type="text" id="signup-source" class="form-input" placeholder="e.g. Google, Friend, or Agent Name">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="signup-pass" class="form-input form-input-pass">
                        <button class="toggle-password-btn" onclick="app.togglePassword('signup-pass', this)">üëÅ</button>
                    </div>
                </div>
                <div id="signup-error" class="error-msg"></div>
                <button id="btn-signup-submit" class="btn btn-primary" onclick="app.signup()">Create Account</button>
                <button class="btn btn-ghost" onclick="app.toggleAuthMode()">Already have an account? Login</button>
            </div>
        </div>
    </div>

    <div id="view-reset" class="view">
        <div class="auth-container">
            <h2 class="headline">Reset Password</h2>
            <div id="reset-step-1">
                <p class="subtext">Enter your email to receive a verification code.</p>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="reset-email" class="form-input">
                </div>
                <div id="reset-error-1" class="error-msg"></div>
                <button id="btn-reset-req" class="btn btn-primary" onclick="app.requestResetCode()">Send Code</button>
                <button class="btn btn-ghost" onclick="app.navTo('view-auth', true)">Cancel</button>
            </div>
            <div id="reset-step-2" class="hidden">
                <p class="subtext">Enter the 6-digit code sent to your email.</p>
                <div class="form-group">
                    <label class="form-label">Verification Code</label>
                    <input type="text" id="reset-code" class="form-input" placeholder="123456">
                </div>
                <div class="form-group">
                    <label class="form-label">New Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="reset-new-pass" class="form-input form-input-pass">
                        <button class="toggle-password-btn" onclick="app.togglePassword('reset-new-pass', this)">üëÅ</button>
                    </div>
                </div>
                <div id="reset-error-2" class="error-msg"></div>
                <button id="btn-reset-conf" class="btn btn-primary" onclick="app.confirmResetPassword()">Update Password</button>
                <button class="btn btn-ghost" onclick="app.resetResetView()">Back</button>
            </div>
        </div>
    </div>

    <div id="view-dashboard" class="view">
        <h2 class="headline">Dashboard</h2>
        <p class="subtext">Select your course level to get started</p>
        <div class="card-menu">
            <div class="menu-item" onclick="app.navToCourse('MSc')">
                <div>
                    <h3>MSc Nursing</h3>
                    <p>Master of Science</p>
                </div>
                <span class="menu-arrow">‚Ä∫</span>
            </div>
            <div class="menu-item" onclick="app.navToCourse('BSc')">
                <div>
                    <h3>BSc Nursing</h3>
                    <p>Bachelor of Science</p>
                </div>
                <span class="menu-arrow">‚Ä∫</span>
            </div>
            <div class="menu-item" onclick="app.navToCourse('PBBSc')">
                <div>
                    <h3>PBBSc Nursing</h3>
                    <p>Post Basic BSc</p>
                </div>
                <span class="menu-arrow">‚Ä∫</span>
            </div>
            <div class="menu-item" onclick="app.navToCourse('GNM')">
                <div>
                    <h3>GNM</h3>
                    <p>General Nursing & Midwifery</p>
                </div>
                <span class="menu-arrow">‚Ä∫</span>
            </div>
            <div class="menu-item premium" onclick="app.checkAccessAndOpen('3D', 'Systems')">
                <div>
                    <h3>3D Models</h3>
                    <p>Interactive Anatomy</p>
                </div>
                <span class="menu-arrow">‚Ä∫</span>
            </div>
            <div class="menu-item hidden" onclick="app.navToCourse('EXAMS')">
                <div>
                    <h3>Nursing Exams</h3>
                    <p>NORCET, ESCI Exclusive Q&A</p>
                </div>
                <span class="menu-arrow">‚Ä∫</span>
            </div>
            <div class="menu-item hidden" onclick="app.checkAccessAndOpen('REQ', 'Documents')">
                <div>
                    <h3>Nursing Requirements</h3>
                    <p>Document Checklist</p>
                </div>
                <span class="menu-arrow">‚Ä∫</span>
            </div>
            <div class="menu-item hidden" onclick="app.checkAccessAndOpen('COMM', 'Basics')">
                <div>
                    <h3>Communicative English</h3>
                    <p>Language Fundamentals</p>
                </div>
                <span class="menu-arrow">‚Ä∫</span>
            </div>
        </div>
    </div>

    <div id="view-submenu" class="view">
        <h2 class="headline" id="submenu-title">Structure</h2>
        <p class="subtext" id="submenu-subtitle">Select an option to continue</p>
        <div class="card-menu" id="submenu-list"></div>
    </div>

    <div id="view-subjects" class="view">
        <h2 class="headline" id="subject-title">Subjects</h2>
        <p class="subtext">Select a subject to open</p>
        <div class="card-menu" id="subject-list"></div>
    </div>

    <div id="view-iframe" class="view"></div>

    <div id="view-paywall" class="view">
        <div class="paywall-container">
            <h2 class="headline">Unlock Premium Content</h2>
            <p class="subtext">Get complete access to this course with lifetime updates</p>
            <div id="paywall-price-display" class="price-wrapper"></div>
            <button class="btn btn-primary" onclick="app.purchaseLockedContent()">Buy Now</button>
            <button class="btn btn-outline" style="margin-top: 10px;" onclick="app.goBack()">Go Back</button>
        </div>
    </div>

    <div id="modal-exit" class="modal-overlay hidden">
        <div class="modal-card">
            <h3 class="headline" style="font-size: 1.5rem; margin-bottom: 20px;">Exit App?</h3>
            <div style="display:flex; flex-direction:column; gap:12px;">
                <button class="btn btn-primary" style="background: linear-gradient(135deg, var(--danger) 0%, #b91c1c 100%);" onclick="app.confirmExit()">Yes, Exit</button>
                <button class="btn btn-outline" onclick="app.cancelExit()">No, Stay</button>
            </div>
        </div>
    </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwjByTFMqWtWVAU29OKEPKg4YM63eHGfYUtJB-SUhgatdB0AkEw2miu8nLu96vkqk47/exec";
const API_KEY = "EZI_SECURE_8829_XJKS_2910";

const PAYMENT_LINKS = {
    'GNM_Third Year_D': 'https://rzp.io/rzp/tx1GzgB0',
    'GNM_Second Year_D': 'https://rzp.io/rzp/7ZEYqAR',
    'GNM_First Year_D': 'https://rzp.io/rzp/m7pEmVy5',
    'GNM_Third Year_F': 'https://rzp.io/rzp/abNPOlM',
    'GNM_Second Year_F': 'https://rzp.io/rzp/7uQDIiN',
    'GNM_First Year_F': 'https://rzp.io/rzp/lVAKDci',
    'BSc_Semester 7_D': 'https://rzp.io/rzp/5brZ609',
    'BSc_Semester 6_D': 'https://rzp.io/rzp/MyOzNDH3',
    'BSc_Semester 5_D': 'https://rzp.io/rzp/6Pyoc2KG',
    'BSc_Semester 4_D': 'https://rzp.io/rzp/XYCluxgu',
    'BSc_Semester 3_D': 'https://rzp.io/rzp/vD6slz2',
    'BSc_Semester 2_D': 'https://rzp.io/rzp/IdW8fls',
    'BSc_Semester 1_D': 'https://rzp.io/rzp/zrR68xJd',
    'BSc_Semester 7_F': 'https://rzp.io/rzp/9v1ESD8',
    'BSc_Semester 6_F': 'https://rzp.io/rzp/XAUmBAb',
    'BSc_Semester 5_F': 'https://rzp.io/rzp/f3ckmawE',
    'BSc_Semester 4_F': 'https://rzp.io/rzp/0xomOEkm',
    'BSc_Semester 3_F': 'https://rzp.io/rzp/XoiqWOK',
    'BSc_Semester 2_F': 'https://rzp.io/rzp/xn9Spct',
    'BSc_Semester 1_F': 'https://rzp.io/rzp/OepEc2wZ',
    'PBBSc_Second Year_D': 'https://rzp.io/rzp/O7QSNXOv',
    'PBBSc_First Year_D': 'https://rzp.io/rzp/TdjmSoy',
    'PBBSc_Second Year_F': 'https://rzp.io/rzp/SG5tGnXT',
    'PBBSc_First Year_F': 'https://rzp.io/rzp/2QOTgbD',
    'MSc_Second Year_F': 'https://rzp.io/rzp/Hpr9NDg',
    'MSc_First Year_F': 'https://rzp.io/rzp/SGdmSPd',
    '3D_Systems_F': 'https://rzp.io/rzp/Xnrnrxe',
    'EXAMS_NORCET_F': 'https://rzp.io/l/dummy-norcet-english',
    'EXAMS_ESCI_F': 'https://rzp.io/l/dummy-esci',
    'REQ_Documents_F': 'https://rzp.io/l/dummy-nursing-req',
    'COMM_Basics_F': 'https://rzp.io/l/dummy-comm-eng'
};

function getDeviceId() {
    let id = localStorage.getItem('ezi_device_id');
    if (!id) {
        id = 'web-' + Math.random().toString(36).substr(2, 9) + Date.now();
        localStorage.setItem('ezi_device_id', id);
    }
    return id;
}

function getPermissionKey(course, section) {
    if (course === '3D') return '3d_models';
    if (course === 'REQ') return 'nursing_req';
    if (course === 'COMM') return 'comm_english';
    if (course === 'EXAMS') {
        if(section.includes('NORCET')) return 'exams_norcet';
        if(section.includes('ESCI')) return 'exams_esci';
    }
    const c = course.toLowerCase();
    if (section.includes('Semester')) {
        const num = section.split(' ')[1];
        const map = {'1':'first', '2':'second', '3':'third', '4':'fourth', '5':'fifth', '6':'sixth', '7':'seventh'};
        return `${c}_${map[num]}_semester`;
    }
    return `${c}_${section.toLowerCase().replace(' ', '_')}`;
}

const COURSES = {
    'MSc': {
        'First Year': [
            { label: 'Advanced Nursing Practice', link: 'msc_1_advanced_nursing_practice.html' },
            { label: 'Nursing Education', link: 'msc_1_nursing_education.html' },
            { label: 'Child Health Nursing', link: 'msc_1_child_health_nursing.html' },
            { label: 'Community Health Nursing', link: 'msc_1_community_health_nursing.html' },
            { label: 'Medical Surgical Nursing', link: 'msc_1_medical_surgical_nursing.html' },
            { label: 'Mental Health Nursing', link: 'msc_1_mental_health_nursing.html' },
            { label: 'Nursing Research & Stats', link: 'msc_1_nursing_research_and_statistics.html' },
            { label: 'OBG Nursing', link: 'msc_1_obgyn_nursing.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'msc1qp.html' }
        ],
        'Second Year': [
            { label: 'Child Health Nursing', link: 'msc_2_child_health_nursing.html' },
            { label: 'Community Health Nursing', link: 'msc_2_community_health_nursing' },
            { label: 'OBG Nursing', link: 'msc_2_obgyn_nursing.html' },
            { label: 'Nursing Management', link: 'msc_2_nursing_management' },
            { label: 'Mental Health Nursing', link: 'msc_2_mental_health_nursing' },
            { label: 'Medical Surgical Nursing', link: 'msc_2_medical_surgical_nursing' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'msc2qp.html' }
        ]
    },
    'BSc': {
        'Semester 1': [
            { label: 'Applied Sociology', link: 'bsc_1_applied_sociology.html' },
            { label: 'Applied Psychology', link: 'bsc_1_applied_psychology.html' },
            { label: 'Applied Physiology', link: 'bsc_1_applied_physiology.html' },
            { label: 'Applied Anatomy', link: 'bsc_1_applied_anatomy.html' },
            { label: 'Nursing Foundation', link: 'bsc_1_nursing_foundation.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'bsc1qp.html' }
        ],
        'Semester 2': [
            { label: 'Applied Nutrition', link: 'bsc_2_applied_nutrition.html' },
            { label: 'Applied Biochemistry', link: 'bsc_2_applied_biochemistry.html' },
            { label: 'Nursing Foundation', link: 'bsc_2_nursing_foundation.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'bsc2qp.html' }
        ],
        'Semester 3': [
            { label: 'Pharmacology', link: 'bsc_3_pharmacology.html' },
            { label: 'Pathology', link: 'bsc_3_pathology.html' },
            { label: 'Applied Microbiology', link: 'bsc_3_applied_microbiology.html' },
            { label: 'Adult Health Nursing', link: 'bsc_3_adult_health_nursing.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'bsc3qp.html' }
        ],
        'Semester 4': [
            { label: 'Pharmacology II', link: 'bsc_4_pharmacology.html' },
            { label: 'Pathology II', link: 'bsc_4_pathology.html' },
            { label: 'Adult Health Nursing II', link: 'bsc_4_adult_health_nursing.html' },
            { label: 'Professionalism', link: 'bsc_4_professionalism.html' },
            { label: 'Genetics', link: 'bsc_4_genetics.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'bsc4qp.html' }
        ],
        'Semester 5': [
            { label: 'Forensic Nursing & Law', link: 'bsc_5_forensic_nursing_indian_law.html' },
            { label: 'Nursing Education', link: 'bsc_5_nursing_education.html' },
            { label: 'Community Health Nursing', link: 'bsc_5_community_health_nursing.html' },
            { label: 'Mental Health Nursing', link: 'bsc_5_mental_health_nursing.html' },
            { label: 'Child Health Nursing', link: 'bsc_5_child_health_nursing.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'bsc5qp.html' }
        ],
        'Semester 6': [
            { label: 'Child Health Nursing II', link: 'bsc_6_child_health_nursing.html' },
            { label: 'Mental Health Nursing II', link: 'bsc_6_mental_health_nursing.html' },
            { label: 'Midwifery & OBG', link: 'bsc_6_midwifery_obgyn.html' },
            { label: 'Nursing Management', link: 'bsc_6_nursing_management_leadership.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'bsc6qp.html' }
        ],
        'Semester 7': [
            { label: 'Community Health Nursing II', link: 'bsc_7_community_health_nursing.html' },
            { label: 'Research & Statistics', link: 'bsc_7_nursing_research_statistics.html' },
            { label: 'Midwifery & OBG II', link: 'bsc_7_midwifery_obgyn.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'bsc7qp.html' }
        ]
    },
    'PBBSc': {
        'First Year': [
            { label: 'Medical Surgical Nursing', link: 'pbbsc_1_medical_surgical_nursing.html' },
            { label: 'Child Health Nursing', link: 'pbbsc_1_child_health_nursing.html' },
            { label: 'Microbiology', link: 'pbbsc_1_microbiology.html' },
            { label: 'Biochemistry & Biophysics', link: 'pbbsc_1_biochemistry_biophysics.html' },
            { label: 'Nutrition & Dietetics', link: 'pbbsc_1_nutrition_dietetics.html' },
            { label: 'Nursing Foundation', link: 'pbbsc_1_nursing_foundation.html' },
            { label: 'Maternal Nursing', link: 'pbbsc_1_maternal_nursing.html' },
            { label: 'Psychology', link: 'pbbsc_1_psychology.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'pbbsc1qp.html' },
            { label: 'Live class', link: 'pbbsc1live.html' }
        ],
        'Second Year': [
            { label: 'Nursing Administration', link: 'pbbsc_2_nursing_service_administration.html' },
            { label: 'Mental Health Nursing', link: 'pbbsc_2_mental_health_nursing.html' },
            { label: 'Nursing Education', link: 'pbbsc_2_nursing_education.html' },
            { label: 'Community Health Nursing', link: 'pbbsc_2_community_health_nursing.html' },
            { label: 'Sociology', link: 'pbbsc_2_sociology.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'pbbsc2qp.html' }
        ]
    },
    'GNM': {
        'First Year': [
            { label: 'Nutrition', link: 'gnm_1_nutrition.html' },
            { label: 'Health Education', link: 'gnm_1_health_education.html' },
            { label: 'Environmental Hygiene', link: 'gnm_1_environmental_hygiene.html' },
            { label: 'Community Health Nursing', link: 'gnm_1_community_health_nursing.html' },
            { label: 'First Aid', link: 'gnm_1_first_aid.html' },
            { label: 'Fundamentals of Nursing', link: 'gnm_1_fundamentals_of_nursing.html' },
            { label: 'Sociology', link: 'gnm_1_sociology.html' },
            { label: 'Psychology', link: 'gnm_1_psychology.html' },
            { label: 'Microbiology', link: 'gnm_1_microbiology.html' },
            { label: 'Anatomy & Physiology', link: 'gnm_1_anatomy_physiology.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'gnm1qp.html' }
        ],
        'Second Year': [
            { label: 'Medical Surgical Nursing I', link: 'gnm_2_medical_surgical_nursing.html' },
            { label: 'Mental Health Nursing', link: 'gnm_2_mental_health_nursing.html' },
            { label: 'Medical Surgical Nursing II', link: 'gnm_2_medical_surgical_nursing_two.html' },
            { label: 'Child Health Nursing', link: 'gnm_2_child_health_nursing.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'gnm2qp.html' }
        ],
        'Third Year': [
            { label: 'Community Health Nursing II', link: 'gnm_3_community_health_nursing.html' },
            { label: 'Midwifery', link: 'gnm_3_midwifery.html' },
            { label: 'Gynecology', link: 'gnm_3_gynecology.html' },
            { label: '<span style="color: #b91c1c;">Previous Year Question Papers</span>', link: 'gnm3qp.html' }
        ]
    },
    '3D': { 'Systems': [{ label: '3D Models', link: '3dmodels.html' }] },
    'EXAMS': {
        'NORCET': [
            { label: 'NORCET 8 (English)', link: 'norcetenglish.html' },
            { label: 'NORCET (Hindi)', link: 'norcethindi.html' }
        ],
        'ESCI': [
            { label: 'ESCI Exclusive Q&A', link: 'esci.html' }
        ]
    },
    'REQ': { 'Documents': [{ label: 'Nursing Requirements', link: 'nursingrequirements.html' }] },
    'COMM': { 'Basics': [{ label: 'Communicative English', link: 'communicativeenglish.html' }] }
};

const app = {
    currentUser: null,
    lockedCourseKey: null,
    lockedCourseSection: null,
    zoomLevel: 1,
    viewStack: [],
    currentView: null,

    init: function() {
        const savedUser = localStorage.getItem('eziUser');
        if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            this.updateWatermark();
            this.renderView('view-dashboard');
            const savedAuth = localStorage.getItem('eziAuth');
            if(savedAuth) { try { this.syncPermissions(JSON.parse(savedAuth)); } catch(e){} }
        } else {
            this.renderView('view-auth');
        }
    },

    checkSessionNow: async function() {
        if (!this.currentUser) return;
        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'check_session', email: this.currentUser.email, deviceId: getDeviceId(), apiKey: API_KEY })
            });
            const data = await res.json();
            if (!data.valid) {
                alert("Logged out: Account active on another device.");
                this.logout();
            }
        } catch(e) {}
    },

    updateWatermark: function() {
        const email = this.currentUser ? this.currentUser.email : '';
        const strip = document.getElementById('wm-diagonal');
        if (email) {
            const text = (email + " ‚Ä¢ ").repeat(30);
            strip.textContent = text;
            strip.style.display = 'flex';
        } else {
            strip.style.display = 'none';
        }
    },

    toggleZoom: function() {
        const wrapper = document.getElementById('iframe-wrapper');
        if(!wrapper) return;
        if (this.zoomLevel === 1) this.zoomLevel = 1.5;
        else if (this.zoomLevel === 1.5) this.zoomLevel = 2.0;
        else this.zoomLevel = 1;

        wrapper.style.transform = `scale(${this.zoomLevel})`;
        wrapper.style.width = `${100 / this.zoomLevel}%`;
        wrapper.style.height = `${100 / this.zoomLevel}%`;

        if (this.zoomLevel > 1) {
            wrapper.style.width = "100%";
            wrapper.style.height = "auto";
        }
        wrapper.style.transform = 'none';
        if (this.zoomLevel === 1) wrapper.style.width = '100%';
        if (this.zoomLevel === 1.5) wrapper.style.width = '150%';
        if (this.zoomLevel === 2.0) wrapper.style.width = '200%';
        wrapper.style.height = '100%';
    },

    syncPermissions: async function(creds) {
        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action:'login', email: creds.email, password: creds.password, deviceId: getDeviceId(), apiKey: API_KEY })
            });
            const data = await res.json();
            if(data.result === 'success'){
                this.currentUser = data.user;
                localStorage.setItem('eziUser', JSON.stringify(data.user));
                this.updateWatermark();
            }
        } catch(e) {}
    },

    login: async function() {
        const email = document.getElementById('login-email').value.trim();
        const pass = document.getElementById('login-pass').value.trim();
        const errorDiv = document.getElementById('login-error');
        const btn = document.getElementById('btn-login-submit');
        errorDiv.textContent = "";

        if(!email || !pass) { errorDiv.textContent = "Fill all fields"; return; }

        btn.textContent = "Logging in...";
        btn.disabled = true;

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action:'login', email, password:pass, deviceId:getDeviceId(), apiKey: API_KEY })
            });
            const data = await res.json();
            if(data.result === 'success'){
                this.currentUser = data.user;
                localStorage.setItem('eziUser', JSON.stringify(data.user));
                localStorage.setItem('eziAuth', JSON.stringify({email: email, password: pass}));
                document.getElementById('login-email').value = "";
                document.getElementById('login-pass').value = "";
                this.updateWatermark();
                this.navTo('view-dashboard', true);
            } else {
                errorDiv.textContent = data.message;
            }
        } catch(e) {
            errorDiv.textContent = "Network Error";
        } finally {
            btn.textContent = "Login Securely";
            btn.disabled = false;
        }
    },

    signup: async function() {
        const name = document.getElementById('signup-name').value.trim();
        const email = document.getElementById('signup-email').value.trim();
        const pass = document.getElementById('signup-pass').value.trim();
        const phone = document.getElementById('signup-phone').value.trim();
        const source = document.getElementById('signup-source').value.trim();
        
        const errorDiv = document.getElementById('signup-error');
        const btn = document.getElementById('btn-signup-submit');
        errorDiv.textContent = "";

        if(!name || !email || !pass || !phone || !source) {
            errorDiv.textContent = "Fill all fields";
            return;
        }

        btn.textContent = "Creating...";
        btn.disabled = true;

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action:'signup', name, email, password:pass, phone, source: source, deviceId:getDeviceId(), apiKey: API_KEY })
            });
            const data = await res.json();
            if(data.result === 'success'){
                this.currentUser = data.user;
                localStorage.setItem('eziUser', JSON.stringify(data.user));
                localStorage.setItem('eziAuth', JSON.stringify({email: email, password: pass}));
                this.updateWatermark();
                alert("Account Created!");
                this.navTo('view-dashboard', true);
            } else {
                errorDiv.textContent = data.message;
            }
        } catch(e) {
            errorDiv.textContent = "Network Error";
        } finally {
            btn.textContent = "Create Account";
            btn.disabled = false;
        }
    },

    requestResetCode: async function() {
        const email = document.getElementById('reset-email').value.trim();
        const btn = document.getElementById('btn-reset-req');
        const err = document.getElementById('reset-error-1');
        err.textContent = "";

        if(!email) { err.textContent = "Enter email"; return; }

        btn.textContent = "Sending...";
        btn.disabled = true;

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action:'reset_request', email: email, apiKey: API_KEY })
            });
            const data = await res.json();
            if(data.result === 'success') {
                document.getElementById('reset-step-1').classList.add('hidden');
                document.getElementById('reset-step-2').classList.remove('hidden');
            } else {
                err.textContent = data.message;
            }
        } catch(e) {
            err.textContent = "Network Error";
        } finally {
            btn.textContent = "Send Code";
            btn.disabled = false;
        }
    },

    confirmResetPassword: async function() {
        const email = document.getElementById('reset-email').value.trim();
        const code = document.getElementById('reset-code').value.trim();
        const newPass = document.getElementById('reset-new-pass').value.trim();
        const btn = document.getElementById('btn-reset-conf');
        const err = document.getElementById('reset-error-2');
        err.textContent = "";

        if(!code || !newPass) { err.textContent = "Fill all fields"; return; }

        btn.textContent = "Updating...";
        btn.disabled = true;

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action:'reset_confirm', email: email, code: code, newPassword: newPass, apiKey: API_KEY })
            });
            const data = await res.json();
            if(data.result === 'success') {
                alert("Password Updated! Please login.");
                this.resetResetView();
                this.navTo('view-auth', true);
            } else {
                err.textContent = data.message;
            }
        } catch(e) {
            err.textContent = "Network Error";
        } finally {
            btn.textContent = "Update Password";
            btn.disabled = false;
        }
    },

    resetResetView: function() {
        document.getElementById('reset-step-1').classList.remove('hidden');
        document.getElementById('reset-step-2').classList.add('hidden');
        document.getElementById('reset-email').value = "";
        document.getElementById('reset-code').value = "";
        document.getElementById('reset-new-pass').value = "";
        document.getElementById('reset-error-1').textContent = "";
        document.getElementById('reset-error-2').textContent = "";
    },

    toggleAuthMode: function() {
        const login = document.getElementById('form-login');
        const signup = document.getElementById('form-signup');
        if(login.classList.contains('hidden')){
            signup.classList.add('hidden');
            login.classList.remove('hidden');
        } else {
            login.classList.add('hidden');
            signup.classList.remove('hidden');
        }
    },

    togglePassword: function(id, btn) {
        const el = document.getElementById(id);
        if(el.type === 'password') {
            el.type = 'text';
            btn.style.color = 'var(--primary)';
        } else {
            el.type = 'password';
            btn.style.color = 'var(--text-muted)';
        }
    },

    logout: function() {
        this.currentUser = null;
        localStorage.removeItem('eziUser');
        localStorage.removeItem('eziAuth');
        this.updateWatermark();
        this.navTo('view-auth', true);
    },

    navTo: function(viewId, isRoot = false, stateData = {}) {
        if (!isRoot && this.currentView) {
            this.viewStack.push({
                viewId: this.currentView,
                course: this.lockedCourseKey,
                section: this.lockedCourseSection
            });
        }
        
        if (isRoot) {
            this.viewStack = [];
        }
        
        this.currentView = viewId;
        this.renderView(viewId);
    },

    renderView: function(viewId) {
        const iframeContainer = document.getElementById('view-iframe');
        if (viewId !== 'view-iframe' && iframeContainer) iframeContainer.innerHTML = '';
        
        const fab = document.getElementById('fab-zoom');
        if (viewId === 'view-iframe') {
            fab.style.display = 'flex';
        } else {
            fab.style.display = 'none';
        }

        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        const target = document.getElementById(viewId);
        if(target) target.classList.add('active');

        const isAuth = viewId === 'view-auth' || viewId === 'view-reset';
        const isDash = viewId === 'view-dashboard';
        
        document.getElementById('btn-back').style.display = (isAuth || isDash) ? 'none' : 'flex';
        document.getElementById('btn-logout').style.display = isAuth ? 'none' : 'block';
        document.getElementById('header-branding').style.opacity = isAuth ? '0' : '1';
    },

    goBack: function() {
        if(!document.getElementById('modal-exit').classList.contains('hidden')) {
            this.cancelExit();
            return;
        }
        
        if (this.viewStack.length === 0) {
            if (this.currentView === 'view-dashboard') {
                this.showExitModal();
            } else {
                this.renderView('view-dashboard');
                this.currentView = 'view-dashboard';
            }
            return;
        }
        
        const prev = this.viewStack.pop();
        this.currentView = prev.viewId;
        
        if (prev.viewId === 'view-submenu' && prev.course) {
            this.renderSubmenu(prev.course);
        } else if (prev.viewId === 'view-subjects' && prev.course && prev.section) {
            this.renderSubjectList(prev.course, prev.section);
        }
        
        this.renderView(prev.viewId);
    },

    showExitModal: function() {
        document.getElementById('modal-exit').classList.remove('hidden');
    },

    cancelExit: function() {
        document.getElementById('modal-exit').classList.add('hidden');
    },

    confirmExit: function() {
        // Clear session and redirect to login
        this.logout();
    },

    navToCourse: function(key) {
        this.renderSubmenu(key);
        this.navTo('view-submenu', false, { course: key });
    },

    renderSubmenu: function(key) {
        const list = document.getElementById('submenu-list');
        list.innerHTML = '';
        document.getElementById('submenu-title').textContent = key;
        document.getElementById('submenu-subtitle').textContent = "Select an option to continue";
        
        const sections = key === '3D' ? Object.keys(COURSES['3D']) : Object.keys(COURSES[key]);
        
        sections.forEach(sec => {
            const item = document.createElement('div');
            item.className = 'menu-item';
            item.innerHTML = `<div><h3>${sec}</h3></div><span class="menu-arrow">‚Ä∫</span>`;
            item.onclick = () => { this.checkAccessAndOpen(key, sec); };
            list.appendChild(item);
        });
    },

    checkAccessAndOpen: function(course, section) {
        this.checkSessionNow();
        this.lockedCourseKey = course;
        this.lockedCourseSection = section;
        const pKey = getPermissionKey(course, section);
        
        if(this.currentUser && this.currentUser.permissions && this.currentUser.permissions[pKey] === true) {
            if (course === '3D' || course === 'REQ' || course === 'COMM') {
                const sub = COURSES[course][section][0];
                this.openContent(sub.link, sub.label);
            } else {
                this.openSubjectList(course, section);
            }
        } else {
            this.renderPaywallInfo(course, section);
            this.navTo('view-paywall', false, { from: 'checkAccess' });
        }
    },

    openSubjectList: function(course, section) {
        this.renderSubjectList(course, section);
        this.navTo('view-subjects', false, { course: course, section: section });
    },

    renderSubjectList: function(course, section) {
        const list = document.getElementById('subject-list');
        list.innerHTML = '';
        document.getElementById('subject-title').textContent = section;
        const subjects = COURSES[course][section];
        
        subjects.forEach(sub => {
            const item = document.createElement('div');
            item.className = 'menu-item';
            item.innerHTML = `<div><h3>${sub.label}</h3></div><span class="menu-arrow">‚Ä∫</span>`;
            item.onclick = () => { this.openContent(sub.link, sub.label); };
            list.appendChild(item);
        });
    },

    openContent: function(url, title, fromHistory = false) {
        const container = document.getElementById('view-iframe');
        if (!fromHistory) this.navTo('view-iframe', false, { sourceUrl: url, title: title });
        else this.renderView('view-iframe');

        const wrapper = document.createElement('div');
        wrapper.id = 'iframe-wrapper';
        wrapper.className = 'iframe-wrapper';

        const iframe = document.createElement('iframe');
        iframe.id = "content-frame";
        iframe.src = url;
        
        wrapper.appendChild(iframe);
        container.innerHTML = '';
        container.appendChild(wrapper);
        this.zoomLevel = 1;
    },
    
    renderPaywallInfo: function(course, section) {
        const display = document.getElementById('paywall-price-display');
        let html = '';
        if (course === 'BSc') {
            html = `
                <div class="price-label">Special Offer</div>
                <div>
                    <span class="price-original">‚Çπ12,000</span>
                    <span class="price-discounted">‚Çπ5,999</span>
                </div>
            `;
        } else if (course === 'GNM') {
            html = `
                <div class="price-label">Special Offer</div>
                <div>
                    <span class="price-original">‚Çπ14,000</span>
                    <span class="price-discounted">‚Çπ5,800</span>
                </div>
            `;
        } else {
            html = '';
        }
        display.innerHTML = html;
    },

    purchaseLockedContent: function() {
        const course = this.lockedCourseKey;
        const section = this.lockedCourseSection || 'Systems';
        
        const discountKey = `${course}_${section}_D`;
        const fullKey = `${course}_${section}_F`;
        
        let url = PAYMENT_LINKS[discountKey];
        if (!url) url = PAYMENT_LINKS[fullKey];
        if (!url) url = `https://www.razorpay.com/fallback_${course}_${section}`;
        
        window.open(url, '_blank');
    }
};

window.onload = function() {
    app.init();
};
</script>
</body>
</html>
