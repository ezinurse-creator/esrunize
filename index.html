<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta id="viewport-meta" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ezi Nurse | Premium Nursing Education</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

<style>
    :root {
        --primary: #5e35b1; /* Deep Purple */
        --primary-light: #7e57c2;
        --secondary: #0091ea; /* Bright Blue */
        --accent: #ff4081; /* Pink for offers */
        --success: #00c853;
        --bg-body: #f5f7fa;
        --bg-card: #ffffff;
        --text-main: #1e293b;
        --text-muted: #64748b;
        --danger: #ef4444;
        --radius-lg: 16px;
        --radius-md: 12px;
        --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
        --shadow-lg: 0 10px 25px rgba(94, 53, 177, 0.15);
        
        /* Gradient Presets for Cards */
        --grad-blue: linear-gradient(135deg, #42a5f5, #1976d2);
        --grad-orange: linear-gradient(135deg, #ffa726, #f57c00);
        --grad-pink: linear-gradient(135deg, #ec407a, #c2185b);
        --grad-green: linear-gradient(135deg, #66bb6a, #388e3c);
        --grad-purple: linear-gradient(135deg, #7e57c2, #512da8);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
    
    html, body { height: 100%; width: 100%; overflow: hidden; background-color: var(--bg-body); color: var(--text-main); }
    body.zoom-mode { overflow: auto !important; }

    #app {
        width: 100%; max-width: 480px; margin: 0 auto;
        background: var(--bg-body); height: 100%; position: relative;
        display: flex; flex-direction: column;
        box-shadow: var(--shadow-lg); overflow: hidden;
    }

    /* --- LAYOUT UTILS --- */
    .view { 
        flex: 1; overflow-y: auto; display: none; 
        padding-bottom: 90px; /* Space for Bottom Nav */
        animation: fadeIn 0.25s ease-out; 
    }
    .view.active { display: block; }
    .view.full-screen { padding-bottom: 0; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* --- HEADER (App Bar) --- */
    .header {
        padding: 15px 20px;
        background: var(--primary); /* Solid color or gradient */
        background: linear-gradient(to right, var(--primary), var(--primary-light));
        color: white;
        display: flex; align-items: center; justify-content: space-between;
        z-index: 20; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        flex-shrink: 0;
    }
    .header-title { font-weight: 700; font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }
    .header-actions { display: flex; gap: 15px; align-items: center; }
    .icon-btn { background: none; border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .back-btn { margin-right: 10px; }

    /* --- AUTH SCREENS --- */
    .auth-container { 
        min-height: 100%; display: flex; flex-direction: column; 
        justify-content: center; padding: 30px; background: white; 
    }
    .auth-header { text-align: center; margin-bottom: 30px; }
    .brand-logo { 
        font-size: 2.5rem; font-weight: 800; 
        background: -webkit-linear-gradient(45deg, var(--primary), var(--secondary));
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
    }

    /* --- FORMS --- */
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; margin-bottom: 6px; font-size: 0.85rem; font-weight: 600; color: var(--text-muted); }
    .form-input { 
        width: 100%; padding: 14px 16px; border: 1px solid #e2e8f0; 
        border-radius: var(--radius-md); font-size: 1rem; background: #f8fafc;
        transition: all 0.2s; font-family: 'Open Sans', sans-serif;
    }
    .form-input:focus { border-color: var(--primary); background: white; outline: none; box-shadow: 0 0 0 3px rgba(94, 53, 177, 0.1); }
    
    .btn { 
        width: 100%; padding: 16px; border-radius: var(--radius-md); border: none; 
        font-size: 1rem; font-weight: 600; cursor: pointer; 
        display: flex; align-items: center; justify-content: center; gap: 8px;
        transition: transform 0.1s;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(94, 53, 177, 0.3); }
    .btn-outline { background: white; border: 2px solid var(--primary); color: var(--primary); }
    .btn-ghost { background: transparent; color: var(--text-muted); font-size: 0.9rem; margin-top: 10px; }

    /* --- DASHBOARD HERO --- */
    .dashboard-hero {
        padding: 20px 20px 10px 20px;
        background: white;
    }
    .welcome-text { font-size: 1.5rem; font-weight: 700; color: var(--text-main); margin-bottom: 5px; }
    .welcome-sub { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 20px; }
    
    .promo-card {
        width: 100%; height: 160px; border-radius: var(--radius-lg);
        background: linear-gradient(to right, #2193b0, #6dd5ed);
        position: relative; overflow: hidden; display: flex; align-items: center; padding: 20px;
        color: white; box-shadow: var(--shadow-lg); margin-bottom: 25px;
    }
    .promo-content h3 { font-size: 1.4rem; font-weight: 800; margin-bottom: 5px; line-height: 1.2; }
    .promo-content p { font-size: 0.9rem; opacity: 0.9; margin-bottom: 15px; }
    .promo-btn { padding: 8px 16px; background: white; color: var(--primary); border-radius: 20px; font-size: 0.8rem; font-weight: 700; border: none; }

    /* --- CATEGORY GRID (The Reference Style) --- */
    .section-title { padding: 0 20px; margin-bottom: 15px; font-size: 1.1rem; font-weight: 700; color: var(--text-main); }
    
    .category-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
        padding: 0 20px 20px 20px;
    }
    .cat-card {
        height: 110px; border-radius: var(--radius-lg);
        padding: 15px; display: flex; flex-direction: column; justify-content: space-between;
        color: white; cursor: pointer; position: relative; overflow: hidden;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.2s;
    }
    .cat-card:active { transform: scale(0.97); }
    .cat-card h3 { font-size: 1.1rem; font-weight: 700; z-index: 2; }
    .cat-card .icon { font-size: 2rem; opacity: 0.3; position: absolute; right: 10px; bottom: 10px; z-index: 1; }
    .cat-arrow { align-self: flex-start; background: rgba(255,255,255,0.2); width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }

    /* Specific Colors */
    .bg-msc { background: var(--grad-purple); }
    .bg-bsc { background: var(--grad-orange); }
    .bg-pbbsc { background: var(--grad-blue); }
    .bg-gnm { background: var(--grad-pink); }
    .bg-3d { background: var(--grad-green); }
    .bg-dark { background: var(--text-main); }

    /* --- LIST LISTINGS (Submenu & Subjects) --- */
    .list-container { padding: 20px; }
    .list-item {
        background: white; padding: 16px; border-radius: var(--radius-md);
        margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between;
        box-shadow: var(--shadow-sm); border: 1px solid #f1f5f9; cursor: pointer;
    }
    .list-item:active { background-color: #f8fafc; }
    .list-info h4 { font-size: 1rem; color: var(--text-main); font-weight: 600; }
    .list-info p { font-size: 0.8rem; color: var(--text-muted); margin-top: 2px; }
    .list-icon { color: var(--primary); margin-right: 15px; }

    /* --- IFRAME & UTILS --- */
    #view-iframe.view { padding: 0 !important; height: 100%; width: 100%; z-index: 50; position: relative; }
    .iframe-wrapper { width: 100%; height: 100%; transform-origin: 0 0; transition: transform 0.3s ease, width 0.3s ease; }
    iframe { width: 100%; height: 100%; border: none; display: block; background: #fff; }

    /* --- WATERMARK --- */
    .watermark-strip {
        position: absolute; top: 50%; left: 50%; width: 200%;
        transform: translate(-50%, -50%) rotate(-45deg);
        z-index: 9999; pointer-events: none;
        display: flex; align-items: center; justify-content: center;
        font-size: 13px; font-weight: 900;
        color: rgba(0, 0, 0, 0.04);
        user-select: none; white-space: nowrap; letter-spacing: 6px; text-transform: uppercase;
    }

    /* --- BOTTOM NAVIGATION --- */
    .bottom-nav {
        position: absolute; bottom: 0; left: 0; width: 100%; height: 70px;
        background: white; border-top: 1px solid #e2e8f0;
        display: flex; justify-content: space-around; align-items: center;
        z-index: 40; padding-bottom: 10px; /* Safe area */
    }
    .nav-item {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        flex: 1; height: 100%; color: var(--text-muted); cursor: pointer;
        background: none; border: none;
    }
    .nav-item.active { color: var(--primary); }
    .nav-item span { font-size: 24px; margin-bottom: 4px; }
    .nav-item label { font-size: 0.7rem; font-weight: 600; }

    /* --- FAB ZOOM --- */
    #fab-zoom {
        position: absolute; bottom: 30px; left: 20px; width: 50px; height: 50px;
        background-color: var(--text-main); border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        display: none; align-items: center; justify-content: center;
        color: white; cursor: pointer; z-index: 100;
    }

    /* --- PAYWALL & MODALS --- */
    .paywall-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; background: white; min-height: 100%; }
    .price-wrapper { margin: 20px 0; }
    .price-original { text-decoration: line-through; color: var(--text-muted); font-size: 1.1rem; margin-right: 10px; }
    .price-discounted { color: var(--text-main); font-weight: 800; font-size: 2.2rem; }
    
    .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 100; backdrop-filter: blur(4px); }
    .modal-card { background: white; width: 85%; padding: 24px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); text-align: center; }
    .hidden { display: none !important; }
    .password-wrapper { position: relative; width: 100%; }
    .toggle-password-btn { position: absolute; right: 12px; top: 12px; border: none; background: none; color: var(--text-muted); cursor: pointer; }
    .error-msg { color: var(--danger); font-size: 0.85rem; margin-top: 5px; text-align: left; }

</style>
</head>
<body>

<div id="app">
    <div id="wm-diagonal" class="watermark-strip"></div>

    <header class="header" id="main-header" style="display:none;">
        <button class="icon-btn back-btn" id="btn-back" onclick="app.goBack()">
            <span class="material-icons-round">arrow_back</span>
        </button>
        <div class="header-title" id="header-title">Ezi<span>Nurse</span></div>
        <div class="header-actions">
            <button class="icon-btn"><span class="material-icons-round">notifications</span></button>
        </div>
    </header>

    <div id="fab-zoom" onclick="app.toggleZoom()"><span class="material-icons-round">zoom_in</span></div>

    <div id="view-auth" class="view active full-screen">
        <div class="auth-container">
            <div class="auth-header">
                <div class="brand-logo">EziNurse</div>
                <h1 style="font-size: 1.5rem; margin-bottom: 5px;">Welcome</h1>
                <p style="color:var(--text-muted);">Sign in to continue your learning</p>
            </div>
            
            <div id="form-login">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="login-email" class="form-input" placeholder="nurse@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="login-pass" class="form-input">
                        <button class="toggle-password-btn" onclick="app.togglePassword('login-pass', this)"><span class="material-icons-round">visibility</span></button>
                    </div>
                    <div style="text-align: right; margin-top:8px;">
                        <span style="font-size:0.85rem; color:var(--primary); font-weight:600; cursor:pointer;" onclick="app.navTo('view-reset')">Forgot Password?</span>
                    </div>
                </div>
                <div id="login-error" class="error-msg" style="text-align:center; margin-bottom:15px;"></div>
                
                <button id="btn-login-submit" class="btn btn-primary" onclick="app.login()">
                    <span>Login Securely</span>
                    <span class="material-icons-round" style="font-size:18px;">login</span>
                </button>
                
                <div style="text-align:center; margin: 20px 0; color:var(--text-muted); font-size:0.8rem;">OR</div>
                
                <button class="btn btn-outline" onclick="app.toggleAuthMode()">Create New Account</button>
            </div>

            <div id="form-signup" class="hidden">
                <div class="form-group"><label class="form-label">Full Name</label><input type="text" id="signup-name" class="form-input" placeholder="Nurse Joy"></div>
                <div class="form-group"><label class="form-label">Email</label><input type="email" id="signup-email" class="form-input"></div>
                <div class="form-group"><label class="form-label">Phone</label><input type="tel" id="signup-phone" class="form-input"></div>
                <div class="form-group"><label class="form-label">How did you hear about us?</label><input type="text" id="signup-source" class="form-input" placeholder="Google, Friend, etc."></div>
                <div class="form-group"><label class="form-label">Password</label>
                    <div class="password-wrapper"><input type="password" id="signup-pass" class="form-input"><button class="toggle-password-btn" onclick="app.togglePassword('signup-pass', this)"><span class="material-icons-round">visibility</span></button></div>
                </div>
                <div id="signup-error" class="error-msg" style="text-align:center;"></div>
                <button id="btn-signup-submit" class="btn btn-primary" style="margin-top:15px;" onclick="app.signup()">Create Account</button>
                <button class="btn btn-ghost" onclick="app.toggleAuthMode()">Already have an account? Login</button>
            </div>
        </div>
    </div>

    <div id="view-reset" class="view full-screen">
        <div class="auth-container">
            <h2 style="font-size:1.5rem; margin-bottom:10px;">Reset Password</h2>
            <div id="reset-step-1">
                <p class="form-label">Enter your email to receive a code.</p>
                <input type="email" id="reset-email" class="form-input" style="margin-bottom:15px;">
                <div id="reset-error-1" class="error-msg"></div>
                <button id="btn-reset-req" class="btn btn-primary" onclick="app.requestResetCode()">Send Code</button>
                <button class="btn btn-ghost" onclick="app.navTo('view-auth', true)">Cancel</button>
            </div>
            <div id="reset-step-2" class="hidden">
                <p class="form-label">Enter 6-digit code & new password.</p>
                <input type="text" id="reset-code" class="form-input" placeholder="Code" style="margin-bottom:10px;">
                <div class="password-wrapper" style="margin-bottom:15px;">
                    <input type="password" id="reset-new-pass" class="form-input" placeholder="New Password">
                    <button class="toggle-password-btn" onclick="app.togglePassword('reset-new-pass', this)"><span class="material-icons-round">visibility</span></button>
                </div>
                <div id="reset-error-2" class="error-msg"></div>
                <button id="btn-reset-conf" class="btn btn-primary" onclick="app.confirmResetPassword()">Update Password</button>
            </div>
        </div>
    </div>

    <div id="view-dashboard" class="view">
        <div class="dashboard-hero">
            <div class="welcome-text">Hello, <span id="user-name-display" style="color:var(--primary);">Nurse</span> ðŸ‘‹</div>
            <div class="welcome-sub">Let's start learning today.</div>
            
            <div class="promo-card">
                <div class="promo-content">
                    <h3>Exam Batch<br>2026 Live</h3>
                    <p>Join the elite nursing squad.</p>
                    <button class="promo-btn">Explore Now</button>
                </div>
                <span class="material-icons-round" style="position:absolute; right:-20px; bottom:-30px; font-size:140px; opacity:0.2;">school</span>
            </div>
        </div>

        <div class="section-title">What are you looking for?</div>
        
        <div class="category-grid">
            <div class="cat-card bg-msc" onclick="app.navToCourse('MSc')">
                <div class="cat-arrow"><span class="material-icons-round" style="font-size:14px;">arrow_forward</span></div>
                <h3>MSc<br>Nursing</h3>
                <span class="material-icons-round icon">psychology</span>
            </div>
            <div class="cat-card bg-bsc" onclick="app.navToCourse('BSc')">
                <div class="cat-arrow"><span class="material-icons-round" style="font-size:14px;">arrow_forward</span></div>
                <h3>BSc<br>Nursing</h3>
                <span class="material-icons-round icon">menu_book</span>
            </div>
            <div class="cat-card bg-pbbsc" onclick="app.navToCourse('PBBSc')">
                <div class="cat-arrow"><span class="material-icons-round" style="font-size:14px;">arrow_forward</span></div>
                <h3>PBBSc<br>Nursing</h3>
                <span class="material-icons-round icon">science</span>
            </div>
            <div class="cat-card bg-gnm" onclick="app.navToCourse('GNM')">
                <div class="cat-arrow"><span class="material-icons-round" style="font-size:14px;">arrow_forward</span></div>
                <h3>GNM<br>General</h3>
                <span class="material-icons-round icon">healing</span>
            </div>
            <div class="cat-card bg-3d" onclick="app.checkAccessAndOpen('3D', 'Systems')">
                <div class="cat-arrow"><span class="material-icons-round" style="font-size:14px;">visibility</span></div>
                <h3>3D<br>Anatomy</h3>
                <span class="material-icons-round icon">3d_rotation</span>
            </div>
            <div class="cat-card bg-dark" onclick="app.navToCourse('EXAMS')">
                <div class="cat-arrow"><span class="material-icons-round" style="font-size:14px;">star</span></div>
                <h3>Competitive<br>Exams</h3>
                <span class="material-icons-round icon">quiz</span>
            </div>
        </div>

        <div class="list-container">
             <div class="list-item" onclick="app.checkAccessAndOpen('REQ', 'Documents')">
                <div style="display:flex; align-items:center;">
                    <span class="material-icons-round list-icon">description</span>
                    <div class="list-info"><h4>Document Checklist</h4><p>Nursing Requirements</p></div>
                </div>
                <span class="material-icons-round" style="color:#ccc;">chevron_right</span>
            </div>
             <div class="list-item" onclick="app.checkAccessAndOpen('COMM', 'Basics')">
                <div style="display:flex; align-items:center;">
                    <span class="material-icons-round list-icon">language</span>
                    <div class="list-info"><h4>English Basics</h4><p>Communicative English</p></div>
                </div>
                <span class="material-icons-round" style="color:#ccc;">chevron_right</span>
            </div>
        </div>
    </div>

    <div id="view-submenu" class="view">
        <div class="list-container" id="submenu-list"></div>
    </div>

    <div id="view-subjects" class="view">
        <div class="list-container" id="subject-list"></div>
    </div>

    <div id="view-iframe" class="view full-screen"></div>

    <div id="view-paywall" class="view full-screen">
        <div class="paywall-container">
            <span class="material-icons-round" style="font-size:64px; color:var(--accent); margin-bottom:20px;">lock</span>
            <h2 style="font-size:1.5rem; margin-bottom:10px;">Unlock Premium</h2>
            <p style="color:var(--text-muted); margin-bottom:20px;">Get complete access to this course material and boost your preparation.</p>
            
            <div id="paywall-price-display" class="price-wrapper"></div>
            
            <button class="btn btn-primary" onclick="app.purchaseLockedContent()">
                <span>Unlock Now</span>
                <span class="material-icons-round">shopping_cart</span>
            </button>
            <button class="btn btn-ghost" onclick="app.goBack()">Maybe Later</button>
        </div>
    </div>

    <nav id="bottom-nav" class="bottom-nav" style="display:none;">
        <button class="nav-item active" onclick="app.navTo('view-dashboard')">
            <span class="material-icons-round">home</span>
            <label>Home</label>
        </button>
        <button class="nav-item" onclick="app.navTo('view-dashboard')">
            <span class="material-icons-round">local_library</span>
            <label>Store</label>
        </button>
        <button class="nav-item" onclick="app.logout()">
            <span class="material-icons-round">person</span>
            <label>Logout</label>
        </button>
    </nav>

    <div id="modal-exit" class="modal-overlay hidden">
        <div class="modal-card">
            <h3 style="margin-bottom:10px;">Exit App?</h3>
            <p style="margin-bottom:20px; color:var(--text-muted);">Are you sure you want to close the app?</p>
            <div style="display:flex; flex-direction:column; gap:10px;">
                <button class="btn btn-primary" style="background-color: var(--danger);" onclick="app.confirmExit()">Yes, Exit</button>
                <button class="btn btn-outline" onclick="app.cancelExit()">No, Stay</button>
            </div>
        </div>
    </div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwjByTFMqWtWVAU29OKEPKg4YM63eHGfYUtJB-SUhgatdB0AkEw2miu8nLu96vkqk47/exec";
const API_KEY = "EZI_SECURE_8829_XJKS_2910";

// --- PAYMENT LINKS (PRESERVED) ---
const PAYMENT_LINKS = {
    'GNM_Third Year_D': 'https://rzp.io/rzp/tx1GzgB0', 'GNM_Second Year_D': 'https://rzp.io/rzp/7ZEYqAR', 'GNM_First Year_D': 'https://rzp.io/rzp/m7pEmVy5',
    'GNM_Third Year_F': 'https://rzp.io/rzp/abNPOlM', 'GNM_Second Year_F': 'https://rzp.io/rzp/7uQDIiN', 'GNM_First Year_F': 'https://rzp.io/rzp/lVAKDci',
    'BSc_Semester 7_D': 'https://rzp.io/rzp/5brZ609', 'BSc_Semester 6_D': 'https://rzp.io/rzp/MyOzNDH3', 'BSc_Semester 5_D': 'https://rzp.io/rzp/6Pyoc2KG',
    'BSc_Semester 4_D': 'https://rzp.io/rzp/XYCluxgu', 'BSc_Semester 3_D': 'https://rzp.io/rzp/vD6slz2', 'BSc_Semester 2_D': 'https://rzp.io/rzp/IdW8fls',
    'BSc_Semester 1_D': 'https://rzp.io/rzp/zrR68xJd', 'BSc_Semester 7_F': 'https://rzp.io/rzp/9v1ESD8', 'BSc_Semester 6_F': 'https://rzp.io/rzp/XAUmBAb',
    'BSc_Semester 5_F': 'https://rzp.io/rzp/f3ckmawE', 'BSc_Semester 4_F': 'https://rzp.io/rzp/0xomOEkm', 'BSc_Semester 3_F': 'https://rzp.io/rzp/XoiqWOK',
    'BSc_Semester 2_F': 'https://rzp.io/rzp/xn9Spct', 'BSc_Semester 1_F': 'https://rzp.io/rzp/OepEc2wZ', 'PBBSc_Second Year_D': 'https://rzp.io/rzp/O7QSNXOv',
    'PBBSc_First Year_D': 'https://rzp.io/rzp/TdjmSoy', 'PBBSc_Second Year_F': 'https://rzp.io/rzp/SG5tGnXT', 'PBBSc_First Year_F': 'https://rzp.io/rzp/2QOTgbD',
    'MSc_Second Year_F': 'https://rzp.io/rzp/Hpr9NDg', 'MSc_First Year_F': 'https://rzp.io/rzp/SGdmSPd', '3D_Systems_F': 'https://rzp.io/rzp/Xnrnrxe',
    'EXAMS_NORCET_F': 'https://rzp.io/l/dummy-norcet-english', 'EXAMS_ESCI_F': 'https://rzp.io/l/dummy-esci', 'REQ_Documents_F': 'https://rzp.io/l/dummy-nursing-req',
    'COMM_Basics_F': 'https://rzp.io/l/dummy-comm-eng'
};

function getDeviceId() {
    let id = localStorage.getItem('ezi_device_id');
    if (!id) { id = 'web-' + Math.random().toString(36).substr(2, 9) + Date.now(); localStorage.setItem('ezi_device_id', id); }
    return id;
}

function getPermissionKey(course, section) {
    if (course === '3D') return '3d_models';
    if (course === 'REQ') return 'nursing_req';
    if (course === 'COMM') return 'comm_english';
    if (course === 'EXAMS') { if(section.includes('NORCET')) return 'exams_norcet'; if(section.includes('ESCI')) return 'exams_esci'; }
    const c = course.toLowerCase();
    if (section.includes('Semester')) {
        const num = section.split(' ')[1];
        const map = {'1':'first', '2':'second', '3':'third', '4':'fourth', '5':'fifth', '6':'sixth', '7':'seventh'};
        return `${c}_${map[num]}_semester`;
    }
    return `${c}_${section.toLowerCase().replace(' ', '_')}`;
}

// --- COURSE DATA (PRESERVED) ---
const COURSES = {
    'MSc': {
        'First Year': [
            { label: 'Advanced Nursing Practice', link: 'msc_1_advanced_nursing_practice.html' }, { label: 'Nursing Education', link: 'msc_1_nursing_education.html' },
            { label: 'Child Health Nursing', link: 'msc_1_child_health_nursing.html' }, { label: 'Community Health Nursing', link: 'msc_1_community_health_nursing.html' },
            { label: 'Medical Surgical Nursing', link: 'msc_1_medical_surgical_nursing.html' }, { label: 'Mental Health Nursing', link: 'msc_1_mental_health_nursing.html' },
            { label: 'Nursing Research & Stats', link: 'msc_1_nursing_research_and_statistics.html' }, { label: 'OBG Nursing', link: 'msc_1_obgyn_nursing.html' },
            { label: '<span style="color: #ef4444;">Previous Year Question Papers</span>', link: 'msc1qp.html' }
        ],
        'Second Year': [
            { label: 'Child Health Nursing', link: 'msc_2_child_health_nursing.html' }, { label: 'Community Health Nursing', link: 'msc_2_community_health_nursing' },
            { label: 'OBG Nursing', link: 'msc_2_obgyn_nursing.html' }, { label: 'Nursing Management', link: 'msc_2_nursing_management' },
            { label: 'Mental Health Nursing', link: 'msc_2_mental_health_nursing' }, { label: 'Medical Surgical Nursing', link: 'msc_2_medical_surgical_nursing' },
            { label: '<span style="color: #ef4444;">Previous Year Question Papers</span>', link: 'msc2qp.html' }
        ]
    },
    'BSc': {
        'Semester 1': [{ label: 'Applied Sociology', link: 'bsc_1_applied_sociology.html' }, { label: 'Applied Psychology', link: 'bsc_1_applied_psychology.html' }, { label: 'Applied Physiology', link: 'bsc_1_applied_physiology.html' }, { label: 'Applied Anatomy', link: 'bsc_1_applied_anatomy.html' }, { label: 'Nursing Foundation', link: 'bsc_1_nursing_foundation.html' }, { label: 'QP', link: 'bsc1qp.html' }],
        'Semester 2': [{ label: 'Applied Nutrition', link: 'bsc_2_applied_nutrition.html' }, { label: 'Applied Biochemistry', link: 'bsc_2_applied_biochemistry.html' }, { label: 'Nursing Foundation', link: 'bsc_2_nursing_foundation.html' }, { label: 'QP', link: 'bsc2qp.html' }],
        'Semester 3': [{ label: 'Pharmacology', link: 'bsc_3_pharmacology.html' }, { label: 'Pathology', link: 'bsc_3_pathology.html' }, { label: 'Microbiology', link: 'bsc_3_applied_microbiology.html' }, { label: 'Adult Health Nursing', link: 'bsc_3_adult_health_nursing.html' }, { label: 'QP', link: 'bsc3qp.html' }],
        'Semester 4': [{ label: 'Pharmacology II', link: 'bsc_4_pharmacology.html' }, { label: 'Pathology II', link: 'bsc_4_pathology.html' }, { label: 'Adult Health II', link: 'bsc_4_adult_health_nursing.html' }, { label: 'Professionalism', link: 'bsc_4_professionalism.html' }, { label: 'Genetics', link: 'bsc_4_genetics.html' }, { label: 'QP', link: 'bsc4qp.html' }],
        'Semester 5': [{ label: 'Forensic Nursing', link: 'bsc_5_forensic_nursing_indian_law.html' }, { label: 'Education', link: 'bsc_5_nursing_education.html' }, { label: 'Community Health', link: 'bsc_5_community_health_nursing.html' }, { label: 'Mental Health', link: 'bsc_5_mental_health_nursing.html' }, { label: 'Child Health', link: 'bsc_5_child_health_nursing.html' }, { label: 'QP', link: 'bsc5qp.html' }],
        'Semester 6': [{ label: 'Child Health II', link: 'bsc_6_child_health_nursing.html' }, { label: 'Mental Health II', link: 'bsc_6_mental_health_nursing.html' }, { label: 'Midwifery', link: 'bsc_6_midwifery_obgyn.html' }, { label: 'Management', link: 'bsc_6_nursing_management_leadership.html' }, { label: 'QP', link: 'bsc6qp.html' }],
        'Semester 7': [{ label: 'Community Health II', link: 'bsc_7_community_health_nursing.html' }, { label: 'Research', link: 'bsc_7_nursing_research_statistics.html' }, { label: 'Midwifery II', link: 'bsc_7_midwifery_obgyn.html' }, { label: 'QP', link: 'bsc7qp.html' }]
    },
    'PBBSc': {
        'First Year': [{ label: 'Medical Surgical', link: 'pbbsc_1_medical_surgical_nursing.html' }, { label: 'Child Health', link: 'pbbsc_1_child_health_nursing.html' }, { label: 'Microbiology', link: 'pbbsc_1_microbiology.html' }, { label: 'Biochem/Biophys', link: 'pbbsc_1_biochemistry_biophysics.html' }, { label: 'Nutrition', link: 'pbbsc_1_nutrition_dietetics.html' }, { label: 'Foundation', link: 'pbbsc_1_nursing_foundation.html' }, { label: 'Maternal', link: 'pbbsc_1_maternal_nursing.html' }, { label: 'Psychology', link: 'pbbsc_1_psychology.html' }, { label: 'QP', link: 'pbbsc1qp.html' }, { label: 'Live class', link: 'pbbsc1live.html' }],
        'Second Year': [{ label: 'Administration', link: 'pbbsc_2_nursing_service_administration.html' }, { label: 'Mental Health', link: 'pbbsc_2_mental_health_nursing.html' }, { label: 'Education', link: 'pbbsc_2_nursing_education.html' }, { label: 'Community Health', link: 'pbbsc_2_community_health_nursing.html' }, { label: 'Sociology', link: 'pbbsc_2_sociology.html' }, { label: 'QP', link: 'pbbsc2qp.html' }]
    },
    'GNM': {
        'First Year': [{ label: 'Nutrition', link: 'gnm_1_nutrition.html' }, { label: 'Health Ed', link: 'gnm_1_health_education.html' }, { label: 'Env Hygiene', link: 'gnm_1_environmental_hygiene.html' }, { label: 'Community Health', link: 'gnm_1_community_health_nursing.html' }, { label: 'First Aid', link: 'gnm_1_first_aid.html' }, { label: 'Fundamentals', link: 'gnm_1_fundamentals_of_nursing.html' }, { label: 'Sociology', link: 'gnm_1_sociology.html' }, { label: 'Psychology', link: 'gnm_1_psychology.html' }, { label: 'Microbiology', link: 'gnm_1_microbiology.html' }, { label: 'Anatomy', link: 'gnm_1_anatomy_physiology.html' }, { label: 'QP', link: 'gnm1qp.html' }],
        'Second Year': [{ label: 'MedSurg I', link: 'gnm_2_medical_surgical_nursing.html' }, { label: 'Mental Health', link: 'gnm_2_mental_health_nursing.html' }, { label: 'MedSurg II', link: 'gnm_2_medical_surgical_nursing_two.html' }, { label: 'Child Health', link: 'gnm_2_child_health_nursing.html' }, { label: 'QP', link: 'gnm2qp.html' }],
        'Third Year': [{ label: 'Community Health II', link: 'gnm_3_community_health_nursing.html' }, { label: 'Midwifery', link: 'gnm_3_midwifery.html' }, { label: 'Gynecology', link: 'gnm_3_gynecology.html' }, { label: 'QP', link: 'gnm3qp.html' }]
    },
    '3D': { 'Systems': [{ label: 'Interactive 3D Models', link: '3dmodels.html' }] },
    'EXAMS': { 'NORCET': [{ label: 'NORCET 8 (English)', link: 'norcetenglish.html' }, { label: 'NORCET (Hindi)', link: 'norcethindi.html' }], 'ESCI': [{ label: 'ESCI Exclusive Q&A', link: 'esci.html' }] },
    'REQ': { 'Documents': [{ label: 'Nursing Requirements', link: 'nursingrequirements.html' }] },
    'COMM': { 'Basics': [{ label: 'Communicative English', link: 'communicativeenglish.html' }] }
};

const app = {
    currentUser: null,
    lockedCourseKey: null,
    lockedCourseSection: null,
    zoomLevel: 1,

    init: function() {
        const savedUser = localStorage.getItem('eziUser');
        if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            this.updateWatermark();
            if(this.currentUser.name) document.getElementById('user-name-display').textContent = this.currentUser.name.split(' ')[0];
            history.replaceState({ viewId: 'view-exit-guard' }, 'Exit Guard', '#exit');
            history.pushState({ viewId: 'view-dashboard' }, 'Dashboard', '#dashboard');
            this.renderView('view-dashboard');
            const savedAuth = localStorage.getItem('eziAuth');
            if(savedAuth) { try { this.syncPermissions(JSON.parse(savedAuth)); } catch(e){} }
        } else {
            history.replaceState({ viewId: 'view-auth' }, 'Login', '#login');
            this.renderView('view-auth');
        }

        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.viewId) {
                if (event.state.viewId === 'view-exit-guard') {
                    this.showExitModal();
                    this.renderView('view-dashboard');
                    return;
                }
                if (event.state.viewId === 'view-submenu') {
                    const c = event.state.course || this.lockedCourseKey;
                    if(c) { this.renderSubmenu(c); this.renderView('view-submenu'); } 
                    else this.renderView('view-dashboard');
                } else if (event.state.viewId === 'view-subjects') {
                    const c = event.state.course || this.lockedCourseKey;
                    const s = event.state.section || this.lockedCourseSection;
                    if (c && s) { this.renderSubjectList(c, s); this.renderView('view-subjects'); } 
                    else this.renderView('view-dashboard');
                } else if (event.state.viewId === 'view-iframe') {
                    if(event.state.sourceUrl) this.openContent(event.state.sourceUrl, event.state.title, true);
                    else this.renderView('view-dashboard');
                } else {
                    this.renderView(event.state.viewId);
                }
            } else {
                this.currentUser ? this.renderView('view-dashboard') : this.renderView('view-auth');
            }
        });
    },

    checkSessionNow: async function() {
        if (!this.currentUser) return;
        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'check_session', email: this.currentUser.email, deviceId: getDeviceId(), apiKey: API_KEY }) });
            const data = await res.json();
            if (!data.valid) { alert("Logged out: Account active on another device."); this.logout(); }
        } catch(e) {}
    },

    updateWatermark: function() {
        const email = this.currentUser ? this.currentUser.email : '';
        const strip = document.getElementById('wm-diagonal');
        if (email) {
            const text = (email + " â€¢ ").repeat(30);
            strip.textContent = text;
            strip.style.display = 'flex';
        } else {
            strip.style.display = 'none';
        }
    },

    toggleZoom: function() {
        const wrapper = document.getElementById('iframe-wrapper');
        if(!wrapper) return;
        if (this.zoomLevel === 1) this.zoomLevel = 1.5;
        else if (this.zoomLevel === 1.5) this.zoomLevel = 2.0;
        else this.zoomLevel = 1;

        wrapper.style.transform = `scale(${this.zoomLevel})`;
        wrapper.style.width = this.zoomLevel > 1 ? "100%" : `${100 / this.zoomLevel}%`;
        wrapper.style.height = this.zoomLevel > 1 ? "auto" : `${100 / this.zoomLevel}%`;
        wrapper.style.transform = 'none';
        
        if (this.zoomLevel === 1) wrapper.style.width = '100%';
        if (this.zoomLevel === 1.5) wrapper.style.width = '150%';
        if (this.zoomLevel === 2.0) wrapper.style.width = '200%';
    },

    syncPermissions: async function(creds) {
        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action:'login', email: creds.email, password: creds.password, deviceId: getDeviceId(), apiKey: API_KEY }) });
            const data = await res.json();
            if(data.result === 'success'){
                this.currentUser = data.user;
                localStorage.setItem('eziUser', JSON.stringify(data.user));
                this.updateWatermark();
            }
        } catch(e) {}
    },

    login: async function() {
        const email = document.getElementById('login-email').value.trim();
        const pass = document.getElementById('login-pass').value.trim();
        const errorDiv = document.getElementById('login-error');
        const btn = document.getElementById('btn-login-submit');
        errorDiv.textContent = "";

        if(!email || !pass) { errorDiv.textContent = "Fill all fields"; return; }
        btn.innerHTML = '<span>Logging in...</span>'; btn.disabled = true;

        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action:'login', email, password:pass, deviceId:getDeviceId(), apiKey: API_KEY }) });
            const data = await res.json();
            if(data.result === 'success'){
                this.currentUser = data.user;
                localStorage.setItem('eziUser', JSON.stringify(data.user));
                localStorage.setItem('eziAuth', JSON.stringify({email: email, password: pass}));
                document.getElementById('login-email').value = ""; document.getElementById('login-pass').value = "";
                this.updateWatermark();
                if(data.user.name) document.getElementById('user-name-display').textContent = data.user.name.split(' ')[0];
                this.navTo('view-dashboard', true);
            } else { errorDiv.textContent = data.message; }
        } catch(e) { errorDiv.textContent = "Network Error"; } 
        finally { btn.innerHTML = '<span>Login Securely</span><span class="material-icons-round" style="font-size:18px;">login</span>'; btn.disabled = false; }
    },

    signup: async function() {
        const name = document.getElementById('signup-name').value.trim();
        const email = document.getElementById('signup-email').value.trim();
        const pass = document.getElementById('signup-pass').value.trim();
        const phone = document.getElementById('signup-phone').value.trim();
        const source = document.getElementById('signup-source').value.trim();
        const errorDiv = document.getElementById('signup-error');
        const btn = document.getElementById('btn-signup-submit');
        errorDiv.textContent = "";

        if(!name || !email || !pass || !phone || !source) { errorDiv.textContent = "Fill all fields"; return; }
        btn.textContent = "Creating..."; btn.disabled = true;

        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action:'signup', name, email, password:pass, phone, source: source, deviceId:getDeviceId(), apiKey: API_KEY }) });
            const data = await res.json();
            if(data.result === 'success'){
                this.currentUser = data.user;
                localStorage.setItem('eziUser', JSON.stringify(data.user));
                localStorage.setItem('eziAuth', JSON.stringify({email: email, password: pass}));
                this.updateWatermark();
                alert("Account Created!");
                if(data.user.name) document.getElementById('user-name-display').textContent = data.user.name.split(' ')[0];
                this.navTo('view-dashboard', true);
            } else { errorDiv.textContent = data.message; }
        } catch(e) { errorDiv.textContent = "Network Error"; } 
        finally { btn.textContent = "Create Account"; btn.disabled = false; }
    },

    // --- RESET PASSWORD LOGIC ---
    requestResetCode: async function() {
        const email = document.getElementById('reset-email').value.trim();
        const btn = document.getElementById('btn-reset-req');
        const err = document.getElementById('reset-error-1');
        err.textContent = "";
        if(!email) { err.textContent = "Enter email"; return; }
        btn.textContent = "Sending..."; btn.disabled = true;
        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action:'reset_request', email: email, apiKey: API_KEY }) });
            const data = await res.json();
            if(data.result === 'success') {
                document.getElementById('reset-step-1').classList.add('hidden');
                document.getElementById('reset-step-2').classList.remove('hidden');
            } else { err.textContent = data.message; }
        } catch(e) { err.textContent = "Network Error"; } finally { btn.textContent = "Send Code"; btn.disabled = false; }
    },
    confirmResetPassword: async function() {
        const email = document.getElementById('reset-email').value.trim();
        const code = document.getElementById('reset-code').value.trim();
        const newPass = document.getElementById('reset-new-pass').value.trim();
        const btn = document.getElementById('btn-reset-conf');
        const err = document.getElementById('reset-error-2');
        err.textContent = "";
        if(!code || !newPass) { err.textContent = "Fill all fields"; return; }
        btn.textContent = "Updating..."; btn.disabled = true;
        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action:'reset_confirm', email: email, code: code, newPassword: newPass, apiKey: API_KEY }) });
            const data = await res.json();
            if(data.result === 'success') {
                alert("Password Updated! Please login.");
                this.resetResetView(); this.navTo('view-auth', true);
            } else { err.textContent = data.message; }
        } catch(e) { err.textContent = "Network Error"; } finally { btn.textContent = "Update Password"; btn.disabled = false; }
    },
    resetResetView: function() {
        document.getElementById('reset-step-1').classList.remove('hidden');
        document.getElementById('reset-step-2').classList.add('hidden');
        document.getElementById('reset-email').value = ""; document.getElementById('reset-code').value = "";
        document.getElementById('reset-new-pass').value = "";
    },

    toggleAuthMode: function() {
        const login = document.getElementById('form-login');
        const signup = document.getElementById('form-signup');
        if(login.classList.contains('hidden')){ signup.classList.add('hidden'); login.classList.remove('hidden'); } 
        else { login.classList.add('hidden'); signup.classList.remove('hidden'); }
    },

    togglePassword: function(id, btn) {
        const el = document.getElementById(id);
        const icon = btn.querySelector('span');
        if(el.type === 'password') { el.type = 'text'; icon.textContent = 'visibility_off'; btn.style.color = 'var(--primary)'; } 
        else { el.type = 'password'; icon.textContent = 'visibility'; btn.style.color = 'var(--text-muted)'; }
    },

    logout: function() {
        this.currentUser = null;
        localStorage.removeItem('eziUser'); localStorage.removeItem('eziAuth');
        this.updateWatermark(); this.navTo('view-auth', true);
    },

    navTo: function(viewId, isRoot = false, stateData = {}) {
        const state = { viewId: viewId, ...stateData };
        if (isRoot) {
            if (viewId === 'view-dashboard') {
                history.replaceState({ viewId: 'view-exit-guard' }, null, '#exit');
                history.pushState(state, null, `#${viewId.replace('view-', '')}`);
            } else { history.replaceState(state, null, `#${viewId.replace('view-', '')}`); }
        } else { history.pushState(state, null, `#${viewId.replace('view-', '')}`); }
        this.renderView(viewId);
    },

    renderView: function(viewId) {
        const iframeContainer = document.getElementById('view-iframe');
        if (viewId !== 'view-iframe' && iframeContainer) iframeContainer.innerHTML = '';
        
        // --- UI STATE MANAGEMENT ---
        const fab = document.getElementById('fab-zoom');
        const header = document.getElementById('main-header');
        const bottomNav = document.getElementById('bottom-nav');
        
        fab.style.display = (viewId === 'view-iframe') ? 'flex' : 'none';
        
        // Show Bottom Nav only on Dashboard
        bottomNav.style.display = (viewId === 'view-dashboard') ? 'flex' : 'none';
        
        // Header Logic
        const isAuth = viewId === 'view-auth' || viewId === 'view-reset';
        const isDash = viewId === 'view-dashboard';
        
        if (isAuth || isDash) {
            header.style.display = 'none'; // Dashboard has its own hero section
        } else {
            header.style.display = 'flex';
        }

        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        const target = document.getElementById(viewId);
        if(target) target.classList.add('active');
    },

    goBack: function() {
        if(!document.getElementById('modal-exit').classList.contains('hidden')) { this.cancelExit(); return; }
        window.history.back();
    },
    showExitModal: function() { document.getElementById('modal-exit').classList.remove('hidden'); },
    cancelExit: function() { document.getElementById('modal-exit').classList.add('hidden'); history.pushState({ viewId: 'view-dashboard' }, 'Dashboard', '#dashboard'); },
    confirmExit: function() { window.history.back(); },

    navToCourse: function(key) { this.renderSubmenu(key); this.navTo('view-submenu', false, { course: key }); },

    renderSubmenu: function(key) {
        const list = document.getElementById('submenu-list');
        list.innerHTML = '';
        // Update header title dynamically
        document.getElementById('header-title').innerHTML = `<span>${key}</span> Details`;
        
        const sections = key === '3D' ? Object.keys(COURSES['3D']) : Object.keys(COURSES[key]);
        sections.forEach(sec => {
            const item = document.createElement('div');
            item.className = 'list-item';
            item.innerHTML = `<div style="display:flex; align-items:center;"><span class="material-icons-round list-icon">folder_open</span><div class="list-info"><h4>${sec}</h4></div></div><span class="material-icons-round" style="color:#ccc;">chevron_right</span>`;
            item.onclick = () => { this.checkAccessAndOpen(key, sec); };
            list.appendChild(item);
        });
    },

    checkAccessAndOpen: function(course, section) {
        this.checkSessionNow();
        this.lockedCourseKey = course; this.lockedCourseSection = section;
        const pKey = getPermissionKey(course, section);
        if(this.currentUser && this.currentUser.permissions && this.currentUser.permissions[pKey] === true) {
            if (course === '3D' || course === 'REQ' || course === 'COMM') {
                const sub = COURSES[course][section][0];
                this.openContent(sub.link, sub.label);
            } else { this.openSubjectList(course, section); }
        } else {
            this.renderPaywallInfo(course, section);
            this.navTo('view-paywall', false, { from: 'checkAccess' });
        }
    },

    openSubjectList: function(course, section) { this.renderSubjectList(course, section); this.navTo('view-subjects', false, { course: course, section: section }); },

    renderSubjectList: function(course, section) {
        const list = document.getElementById('subject-list');
        list.innerHTML = '';
        document.getElementById('header-title').textContent = section;
        const subjects = COURSES[course][section];
        subjects.forEach(sub => {
            const item = document.createElement('div');
            item.className = 'list-item';
            item.innerHTML = `<div style="display:flex; align-items:center;"><span class="material-icons-round list-icon">article</span><div class="list-info"><h4>${sub.label.replace(/<[^>]*>?/gm, '')}</h4></div></div><span class="material-icons-round" style="color:#ccc;">play_circle_outline</span>`;
            item.onclick = () => { this.openContent(sub.link, sub.label); };
            list.appendChild(item);
        });
    },

    openContent: function(url, title, fromHistory = false) {
        const container = document.getElementById('view-iframe');
        if (!fromHistory) this.navTo('view-iframe', false, { sourceUrl: url, title: title });
        else this.renderView('view-iframe');

        const wrapper = document.createElement('div');
        wrapper.id = 'iframe-wrapper'; wrapper.className = 'iframe-wrapper';
        const iframe = document.createElement('iframe');
        iframe.id = "content-frame"; iframe.src = url;
        wrapper.appendChild(iframe);
        container.innerHTML = ''; container.appendChild(wrapper);
        this.zoomLevel = 1;
    },
    
    renderPaywallInfo: function(course, section) {
        const display = document.getElementById('paywall-price-display');
        let html = '';
        if (course === 'BSc') { html = `<div><span class="price-original">â‚¹12,000</span><span class="price-discounted">â‚¹5,999</span></div>`; } 
        else if (course === 'GNM') { html = `<div><span class="price-original">â‚¹14,000</span><span class="price-discounted">â‚¹5,800</span></div>`; }
        display.innerHTML = html;
    },

    purchaseLockedContent: function() {
        const course = this.lockedCourseKey;
        const section = this.lockedCourseSection || 'Systems';
        const discountKey = `${course}_${section}_D`;
        const fullKey = `${course}_${section}_F`;
        let url = PAYMENT_LINKS[discountKey] || PAYMENT_LINKS[fullKey] || `https://www.razorpay.com/fallback`;
        window.open(url, '_blank');
    }
};

window.onload = function() { app.init(); };
</script>
</body>
</html>
